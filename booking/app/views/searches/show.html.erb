<h1>Ticket Search</h1>

<div>
  <%= form_tag search_path, method: :get do %>
    <div>
      <%= select_tag :first_railway_station_id,
                     options_from_collection_for_select(@stations, :id, :title)%>
    </div>
    <div>
      <%= select_tag :last_railway_station_id,
                     options_from_collection_for_select(@stations, :id, :title)%>
    </div>
    <div><%= submit_tag "Find" %>
    </div>
  <% end %>
</div>

<% if @error.present? %>
  <p>
    <%= @error %>
  </p>
<% end %>

<p>
  <% if @routes %>
  <table class="table">
    <tr>
      <th>Train</th>
      <th>Route</th>
      <th>Time departure</th>
      <th>Time arrival</th>
      <td></td>
    </tr>
    <% @routes.each do |route| %>
      <% route.trains.each do |train| %>
        <tr>
          <td><%= train.number %></td>
          <td><%= route.name %></td>
          <td><%= "#{@first_railway_station.title} - #{@first_railway_station.time(train.route, :departure)} "%></td>
          <td><%= "#{@last_railway_station.title} - #{@last_railway_station.time(train.route, :arrival)} "%></td>
          <td><%= link_to "Buy ticket", new_ticket_path(ticket: { first_railway_station_id: @first_railway_station.id,
                                                                  last_railway_station_id: @last_railway_station.id, train_id: train.id }) %></td>
        </tr>
      <% end %>
    <% end %>
  </table>
<% end %>
</p>

<%= link_to 'Back', root_path %>
